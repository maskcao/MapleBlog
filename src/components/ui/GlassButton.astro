---
interface Props {
  /** 按钮视觉变体，决定背景、边框与文字颜色 */
  variant?:
    | "primary"     // 主色调（红系）
    | "secondary"   // 次要色调（蓝系）
    | "success"     // 成功（绿系）
    | "warning"     // 警告（橙系）
    | "danger"      // 危险（红系，饱和度更高）
    | "info"        // 信息（浅灰系）
    | "menu";       // 菜单专用（浅灰+橙文字）
  /** 按钮尺寸，影响内边距、字号与圆角 */
  size?: "sm" | "md" | "lg" | "menu";
  /** 是否禁用按钮（同时禁用点击与样式交互） */
  disabled?: boolean;
  /** 是否显示加载动画，自动禁用按钮 */
  loading?: boolean;
  /** 图标 SVG 字符串，传入即渲染；优先级低于 loading */
  icon?: string;
  /** 图标相对于文字的位置 */
  iconPosition?: "left" | "right";
  /** 自定义类名，追加到按钮根节点 */
  className?: string;
  /** 按钮 DOM id，可用于外部脚本或锚点 */
  id?: string;
  /** 原生 title 属性，悬停提示 */
  title?: string;
  /** 按钮类型，对应 HTML 标准 */
  type?: "button" | "submit" | "reset";
  /** 点击事件处理字符串，直接写入 onclick 属性 */
  onClick?: string;
  /** 控制按钮是否渲染完整玻璃样式；false 时仅保留基础结构与尺寸 */
  open?: boolean;
}

const {
  variant = "primary",
  size = "md",
  disabled = false,
  loading = false,
  icon,
  iconPosition = "left",
  className = "",
  id,
  title,
  type = "button",
  onClick,
  open = true,
} = Astro.props;

// 变体样式映射
const variantStyles = {
  primary: {
    base: "rgba(255, 186, 186, 0.25)",
    hover: "rgba(239, 68, 68, 0.35)",
    border: "rgba(248, 113, 113, 0.4)",
    hoverBorder: "rgba(248, 113, 113, 0.6)",
    color: "#dc2626",
    hoverColor: "#ef4444",
    shadow: "rgba(220, 38, 38, 0.25)",
    gradient: "rgba(255, 255, 255, 0.3)",
  },
  secondary: {
    base: "rgba(59, 130, 246, 0.25)",
    hover: "rgba(59, 130, 246, 0.35)",
    border: "rgba(71, 158, 255, 0.4)",
    hoverBorder: "rgba(73, 158, 254, 0.6)",
    color: "#2563eb",
    hoverColor: "#3b82f6",
    shadow: "rgba(37, 99, 235, 0.25)",
    gradient: "rgba(255, 255, 255, 0.3)",
  },
  success: {
    base: "rgba(34, 197, 94, 0.25)",
    hover: "rgba(34, 197, 94, 0.35)",
    border: "rgba(74, 222, 128, 0.4)",
    hoverBorder: "rgba(74, 222, 128, 0.6)",
    color: "#16a34a",
    hoverColor: "#22c55e",
    shadow: "rgba(22, 163, 74, 0.25)",
    gradient: "rgba(255, 255, 255, 0.3)",
  },
  warning: {
    base: "#fb923c",
    hover: "#ffa155",
    border: "#fb7d3c",
    hoverBorder: "#ff6900",
    color: "#ffffff",
    hoverColor: "#ffffff",
    shadow: "rgba(217, 119, 6, 0.25)",
    gradient: "rgba(255, 255, 255, 0.3)",
  },
  danger: {
    base: "rgba(239, 68, 68, 0.25)",
    hover: "rgba(239, 68, 68, 0.35)",
    border: "rgba(248, 113, 113, 0.4)",
    hoverBorder: "rgba(248, 113, 113, 0.6)",
    color: "#dc2626",
    hoverColor: "#ef4444",
    shadow: "rgba(220, 38, 38, 0.25)",
    gradient: "rgba(255, 255, 255, 0.3)",
  },
  info: {
    base: "rgb(244, 244, 244, 0.4)",
    hover: "rgb(244, 244, 244, 0.6)",
    border: "rgba(255, 255, 255, 0.8)",
    hoverBorder: "rgba(255, 255, 255, 0.9)",
    color: "#383838",
    hoverColor: "#272727",
    shadow: "rgba(99, 102, 241, 0.25)",
    gradient: "rgba(255, 255, 255, 0.3)",
  },
  menu: {
    base: "rgb(244, 244, 244, 0.4)",
    hover: "rgb(244, 244, 244, 0.6)",
    border: "rgba(255, 255, 255, 0.8)",
    hoverBorder: "rgba(255, 255, 255, 0.9)",
    color: "rgb(234, 88, 12)",
    hoverColor: "rgb(249, 115, 22)",
    shadow: "rgba(150, 150, 150, 0.6)",
    gradient: "rgba(255, 255, 255, 0.3)",
  },
};

// 尺寸样式映射
const sizeStyles = {
  sm: {
    padding: "0.5rem 0.75rem",
    fontSize: "0.875rem",
    iconSize: "0.875rem",
    gap: "0.375rem",
    // borderRadius: "0.75rem",
    borderRadius: "999px",
  },
  md: {
    padding: "0.75rem 1rem",
    fontSize: "1rem",
    iconSize: "1rem",
    gap: "0.5rem",
    // borderRadius: "1rem",
    borderRadius: "999px",
  },
  lg: {
    padding: "1rem 1.25rem",
    fontSize: "1.1rem",
    iconSize: "1.125rem",
    gap: "0.625rem",
    // borderRadius: "1.25rem",
    borderRadius: "30px",
  },
  menu: {
    padding: "0.5rem 1rem",
    iconSize: "1.25rem",
    fontSize: "inherit",
    gap: "inherit",
    // borderRadius: "9999px",
    borderRadius: "37px",
  },
};

const currentVariant = variantStyles[variant];
const currentSize = sizeStyles[size];
---

<button
  id={id}
  type={type}
  class={open
    ? `glass-button glass-button--${variant} glass-button--${size} select-none ${className} `
    : `gap-[${currentSize.gap}] p-[${currentSize.padding}] select-none ${className} `}
  disabled={disabled || loading}
  title={title}
  onclick={onClick}
>
  {
    loading && (
      <svg class="glass-button__spinner" viewBox="0 0 24 24">
        <circle
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
          fill="none"
          opacity="0.25"
        />
        <path
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          opacity="0.75"
        />
      </svg>
    )
  }

  {
    icon && iconPosition === "left" && !loading && (
      <span class="glass-button__icon" set:html={icon} />
    )
  }

  <span class="glass-button__content">
    <slot />
  </span>

  {
    icon && iconPosition === "right" && !loading && (
      <span class="glass-button__icon" set:html={icon} />
    )
  }
</button>

<style
  define:vars={{
    variantBase: currentVariant.base,
    variantHover: currentVariant.hover,
    variantBorder: currentVariant.border,
    variantHoverBorder: currentVariant.hoverBorder,
    variantColor: currentVariant.color,
    variantHoverColor: currentVariant.hoverColor,
    variantShadow: currentVariant.shadow,
    variantGradient: currentVariant.gradient,
    sizePadding: currentSize.padding,
    sizeFontSize: currentSize.fontSize,
    sizeIconSize: currentSize.iconSize,
    sizeGap: currentSize.gap,
    sizeBorderRadius: currentSize.borderRadius,
  }}
>
  .glass-button {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--sizeGap);
    padding: var(--sizePadding);
    background: var(--variantBase);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid var(--variantBorder);
    border-radius: var(--sizeBorderRadius);
    font-size: var(--sizeFontSize);
    font-weight: 500;
    color: var(--variantColor);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 2.2);
    box-shadow:
      0 4px 6px rgba(0, 0, 0, 0.1),
      inset 1px 1px 2px rgba(255, 255, 255, 0.3);
    user-select: none;
    overflow: hidden;
    text-decoration: none;
    white-space: nowrap;
  }

  .glass-button::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      var(--variantGradient),
      transparent
    );
    transition: left 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    pointer-events: none;
    opacity: 0;
  }

  .glass-button:hover {
    background: var(--variantHover);
    border-color: var(--variantHoverBorder);
    color: var(--variantHoverColor);
    transform: translateY(-2px) scale(1.01);
    box-shadow:
      0 8px 20px var(--variantShadow),
      inset 1px 1px 4px rgba(255, 255, 255, 0.5);
    filter: brightness(1.1) saturate(1.2);
  }

  .glass-button:hover::before {
    left: 100%;
    opacity: 1;
  }

  .glass-button:active {
    transform: translateY(-1px) scale(0.98);
    box-shadow: 0 2px 6px var(--variantShadow);
  }

  .glass-button:disabled {
    cursor: not-allowed;
    opacity: 0.6;
    transform: none;
    pointer-events: none;
  }

  .glass-button:disabled:hover {
    transform: none;
    box-shadow:
      0 4px 6px rgba(0, 0, 0, 0.1),
      inset 1px 1px 2px rgba(255, 255, 255, 0.3);
  }

  .glass-button__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--sizeIconSize);
    height: var(--sizeIconSize);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 2.2);
  }

  .glass-button__icon :global(svg) {
    width: 100%;
    height: 100%;
  }

  .glass-button:hover .glass-button__icon {
    transform: scale(1.2) rotate(-5deg);
    filter: drop-shadow(0 0 4px var(--variantShadow));
  }

  .glass-button__content {
    display: inline-flex;
    align-items: center;
    transition: all 0.3s ease;
  }

  .glass-button__spinner {
    width: var(--sizeIconSize);
    height: var(--sizeIconSize);
    animation: spin 1s linear infinite;
  }

  /* 深色模式适配 */
  .dark {
    .glass-button {
      background: rgba(55, 55, 55, 0.6);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-color: rgba(255, 255, 255, 0.15);
      color: #e5e7eb;
      box-shadow:
        0 4px 8px rgba(0, 0, 0, 0.4),
        inset 1px 1px 3px rgba(255, 255, 255, 0.15);
    }

    .glass-button::before {
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
      );
    }

    .glass-button:hover {
      background: var(--variantHover);
      border-color: var(--variantHoverBorder);
      color: var(--variantHoverColor);
      box-shadow:
        0 6px 14px var(--variantShadow),
        inset 1px 1px 4px rgba(255, 255, 255, 0.2);
      filter: brightness(1.2) saturate(1.3);
    }
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* 特定变体的额外样式 */
  .glass-button--primary:hover .glass-button__icon {
    filter: drop-shadow(0 0 4px rgba(220, 38, 38, 0.5));
  }

  .glass-button--secondary:hover .glass-button__icon {
    filter: drop-shadow(0 0 4px rgba(37, 99, 235, 0.5));
  }

  .glass-button--success:hover .glass-button__icon {
    filter: drop-shadow(0 0 4px rgba(22, 163, 74, 0.5));
  }

  .glass-button--warning:hover .glass-button__icon {
    filter: drop-shadow(0 0 4px rgba(217, 119, 6, 0.5));
  }

  .glass-button--danger:hover .glass-button__icon {
    filter: drop-shadow(0 0 4px rgba(220, 38, 38, 0.5));
  }

  .glass-button--info:hover .glass-button__icon {
    filter: drop-shadow(0 0 4px rgba(99, 102, 241, 0.5));
  }
</style>
