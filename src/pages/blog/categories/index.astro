---
import TaxaLayout from "@components/blog/TaxaLayout.astro";
import { getCollection } from "astro:content";
import { slugify } from "@lib/textConverter";
import { getEntries, getIndex } from "@lib/contentParser";
import { sortByDate } from "@lib/sortFunctions";
import type { BlogEntry } from "@/types";

const taxonomy = "categories";
const title = "分类";

const entryIndex = (await getIndex("blog")) as BlogEntry;
const allPosts = (await getEntries("blog", sortByDate)) as BlogEntry[];
const allBlogCount = allPosts.length;

// // 从content collections获取所有已发布的博客文章
// const allPosts = await getCollection("blog", ({ data }) => {
//   return data.status === "published" && !data.draft;
// });

// 提取所有分类
let allTaxa: string[] = [];
allPosts.forEach((post) => {
  const cat = post.data.categories;
  if (cat) {
    allTaxa.push(slugify(post.data.categories.toString()));
  }
});

// 获取唯一分类列表并排序
const taxa = [...new Set(allTaxa)].sort((a, b) => a.localeCompare(b));
---

<TaxaLayout taxonomy={taxonomy} taxonomyTitle={title} taxa={taxa} allTaxa={allTaxa} />
