---
import { getCollection, type CollectionEntry, render } from "astro:content";
import EntryLayout from "@components/blog/EntryLayout.astro";

export async function getStaticPaths() {
  const isDev = import.meta.env.DEV;

  const blogEntries = await getCollection("blog", ({ data }) => {
    // 生产环境只显示已发布的非草稿文章
    // 开发环境显示所有文章（包括草稿）
    if (isDev) {
      return true; // 开发环境显示所有文章
    }
    return data.draft !== true;
  });

  const paths = blogEntries.map((entry) => ({
    params: { entry: entry.id },
    props: { entry },
  }));

  console.log("paths", paths);
  return paths;
}

interface Props {
  entry: CollectionEntry<"blog">;
}

const { entry } = Astro.props;
const { Content } = await render(entry);
---

<EntryLayout entry={entry}>
  <Content />
</EntryLayout>
