---
import { getCollection } from "astro:content";
import { slugify } from "@lib/textConverter";

// 生成所有标签页面的静态路径
export async function getStaticPaths() {
  const allPosts = await getCollection("notes");

  // 收集所有标签
  const allTags = new Set<string>();
  allPosts.forEach((post) => {
    const postTags = post.data.tags;
    if (postTags && Array.isArray(postTags)) {
      postTags.forEach((tag: string) => {
        allTags.add(tag);
      });
    }
  });

  // 为每个标签生成路径
  return Array.from(allTags).map((tag) => ({
    params: { slug: slugify(tag) },
  }));
}

const { slug } = Astro.params;

// 使用 rewrite 重写到分页路由的第一页，保持 URL 不变
return Astro.rewrite(`/notes/tags/${encodeURI(slug)}/1`);
---
