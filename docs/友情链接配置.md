# 友情链接配置指南

## 功能简介

- 使用本地 JSON 数据源 `public/data/friends.json`，由前端在客户端加载并渲染。
- 支持分类展示、排序、状态指示（`active`/`error`/`lost`）与总数统计。
- 集成到 `/links` 页面，包含友链展示与申请说明；评论区使用 Twikoo 作为申请渠道。
- 不依赖后端或数据库，适合静态部署；更新 JSON 后重新构建/部署即可生效。

## 涉及代码

- `src/pages/links.astro`：路由入口，加载页面布局。
- `src/components/common/LinksEntryLayout.astro`：页面布局，包含 `<FriendLinks />` 友链展示组件与 `<Comment />` 评论模块，以及申请规范说明。
- `src/components/common/FriendLinks.astro`：客户端从 `fetch('/data/friends.json', { cache: 'no-store' })` 读取数据并渲染分类与卡片。
  - 使用字段：
    - `categories`：`code`、`name`、`sort_order`
    - `links`：`name`、`url`、`description`、`avatar`、`status`、`category_code`、`sort_order`
- `public/data/friends.json`：友链数据文件，决定页面实际展示内容。
- `src/types/friendLinks.ts`：类型定义（供参考），其中 `FriendLinkStatus` 为 `active | error | lost`。


## 使用方法

1. 本地预览与准备
   - 确认存在 `public/data/friends.json` 文件。
   - 运行本地开发：`npm run dev`，访问 `/links` 查看效果。

2. 编辑数据文件（示例结构）
   - 添加分类（`code` 与展示 `name`）：
     ```json
     {
       "categories": [
         { "id": "cat-tech", "name": "技术博客", "code": "tech", "sort_order": 1 }
       ],
       "links": []
     }
     ```
   - 添加友链（确保 `category_code` 与分类 `code` 一致）：
     ```json
     {
       "id": "site-xxx",
       "name": "站点名称",
       "url": "https://example.com",
       "description": "一句话简介",
       "avatar": "https://example.com/avatar.png",
       "status": "active",
       "category_code": "tech",
       "sort_order": 1
     }
     ```
   - 字段说明与展示规则：
     - `status`: `active` 正常显示；`error` 显示红色状态指示；`lost` 不展示（用于标记丢失）。
     - `sort_order`: 数值越小越靠前，分类与条目均按此升序渲染。
     - `avatar`: 建议使用 HTTPS 图床，正方形 200×200 以上，失败时将回退为 `/favicon/logo-192x192.png`。

3. 部署与更新
   - 静态托管场景：修改 `public/data/friends.json` 后需要重新构建并部署，线上即生效。
   - 缓存策略：组件使用 `cache: 'no-store'` 避免浏览器缓存；如有 CDN 需确保不对该 JSON 进行长期缓存。

4. 申请流程（建议）
   - 访客在 `/links` 页的评论区（Twikoo）按模板提交申请信息。
   - 管理员审核后，将符合规范的友链手动加入 `public/data/friends.json`（确保分类与字段有效）。
   - 如需后台管理与自动化检测，可自行扩展 API 并返回与 `friends.json` 兼容的结构，再将组件数据源改为接口地址。
